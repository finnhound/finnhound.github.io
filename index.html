<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cartofied Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: white;
      font-family: sans-serif;
    }

    .map-container {
      box-sizing: border-box;
      width: 100vw;
      height: 100vh;
      padding: 6px;
      position: relative;
    }

    .map-container iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }

    /* Info button styling */
    .info-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: background 0.2s;
    }

    .info-button:hover {
      background: rgba(0, 0, 0, 0.8);
    }

    /* About box styling */
    .about-box {
      position: absolute;
      top: 50px;
      right: 10px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 15px;
      border-radius: 8px;
      max-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: none;
      z-index: 10;
    }

    .about-box h2 {
      margin-top: 0;
    }

    .about-box button.close-btn {
      position: absolute;
      top: 5px;
      right: 8px;
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="map-container">
  <iframe id="mapFrame" allow="geolocation"></iframe>

  <!-- Info button -->
  <button class="info-button" id="infoBtn">i</button>

  <!-- About box -->
  <div class="about-box" id="aboutBox">
    <button class="close-btn" id="closeAbout">&times;</button>
    <h2>About</h2>
    <p>
     Welcome to Cartofied, a MapTiler based mapstyle for OSM which is based off the OpenMapTiler (carto equivalent) style.
      It aims to be more polished and readable than the default OSM carto style, and so is lacking on detail in some areas.
      It is updated once per week as per the MapTiler updates.
    </p>
  </div>
</div>

<script>
  const iframe = document.getElementById('mapFrame');

  // Default map URL
  const defaultMap = "https://api.maptiler.com/maps/019b2817-43ac-7a98-b15b-c204722a617b/?key=1xuGVLLA0XJlvXZT2dFB#0.7/22.80535/2.86559";

  // Load last saved position from localStorage
  const savedPosition = localStorage.getItem('mapPosition');
  iframe.src = savedPosition || defaultMap;

  // Listen for messages from iframe (MapTiler supports postMessage for position changes)
  window.addEventListener('message', (event) => {
    // Only accept messages from the maptiler domain
    if (!event.origin.includes("maptiler.com")) return;

    try {
      const data = JSON.parse(event.data);
      if (data.type === "map-position") {
        // Save the zoom/lat/lng
        localStorage.setItem('mapPosition', `${defaultMap.split('#')[0]}#${data.zoom}/${data.lat}/${data.lng}`);
      }
    } catch (e) {
      // ignore invalid messages
    }
  });

  // About box toggle logic
  const infoBtn = document.getElementById('infoBtn');
  const aboutBox = document.getElementById('aboutBox');
  const closeAbout = document.getElementById('closeAbout');

  infoBtn.addEventListener('click', () => {
    aboutBox.style.display = 'block';
  });

  closeAbout.addEventListener('click', () => {
    aboutBox.style.display = 'none';
  });

  // Close about box if clicking outside
  window.addEventListener('click', (e) => {
    if (e.target !== aboutBox && e.target !== infoBtn && !aboutBox.contains(e.target)) {
      aboutBox.style.display = 'none';
    }
  });
</script>

</body>
</html>
